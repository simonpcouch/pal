<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>The roxygen pal — pal_roxygen • pal</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The roxygen pal — pal_roxygen"><meta name="description" content="The roxygen pal prefixes the selected function with a minimal roxygen2
documentation template. The pal is instructed to only generate a subset
of a complete documentation entry, to be then completed by a developer:
Stub @param descriptions based on defaults and inferred types
Stub @returns entry that describes the return value as well as important
errors and warnings users might encounter.

"><meta property="og:description" content="The roxygen pal prefixes the selected function with a minimal roxygen2
documentation template. The pal is instructed to only generate a subset
of a complete documentation entry, to be then completed by a developer:
Stub @param descriptions based on defaults and inferred types
Stub @returns entry that describes the return value as well as important
errors and warnings users might encounter.

"><meta property="og:image" content="https://simonpcouch.github.io/pal/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pal.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/custom.html">Custom pals</a></li>
    <li><a class="dropdown-item" href="../articles/gallery.html">Gallery</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simonpcouch/pal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The roxygen pal</h1>
      <small class="dont-index">Source: <a href="https://github.com/simonpcouch/pal/blob/main/R/doc-pal-roxygen.R" class="external-link"><code>R/doc-pal-roxygen.R</code></a></small>
      <div class="d-none name"><code>pal_roxygen.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The roxygen pal prefixes the selected function with a minimal roxygen2
documentation template. The pal is instructed to only generate a subset
of a complete documentation entry, to be then completed by a developer:</p><ul><li><p>Stub <code>@param</code> descriptions based on defaults and inferred types</p></li>
<li><p>Stub <code>@returns</code> entry that describes the return value as well as important
errors and warnings users might encounter.</p></li>
</ul></div>


    <div class="section level2">
    <h2 id="cost">Cost<a class="anchor" aria-label="anchor" href="#cost"></a></h2>



<p>The system prompt from a roxygen pal includes something like 1,000 tokens.
Add in 200 tokens for the code that's actually highlighted
and also sent off to the model and you're looking at 1,200 input tokens.
The model returns maybe 10 to 15 lines of relatively barebones royxgen
documentation, so we'll call that 200 output tokens per refactor.</p>
<p>As of the time of writing (October 2024), the default pal model Claude
Sonnet 3.5 costs $3 per million input tokens and $15 per million output
tokens. So, using the default model,
<strong>roxygen pals cost around $4 for every 1,000 generated roxygen documentation
entries</strong>. GPT-4o Mini, by contrast, doesn't tend to infer argument types
correctly as often and
often fails to line-break properly, but <em>does</em> usually return syntactically
valid documentation entries, and it would cost around
20 cents per 1,000 generated roxygen documentation entries.</p>
    </div>
    <div class="section level2">
    <h2 id="gallery">Gallery<a class="anchor" aria-label="anchor" href="#gallery"></a></h2>



<p>This section includes a handful of examples
"<a href="https://github.com/hadley/elmer/tree/e497d627e7be01206df6f1420ca36235141dc22a/R" class="external-link">from the wild</a>"
and are generated with the default model, Claude Sonnet 3.5.</p>
<p>Documenting a function factory:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">deferred_method_transform</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda_expr</span>, <span class="va">transformer</span>, <span class="va">eval_env</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">transformer</span> <span class="op">&lt;-</span> <span class="fu">enexpr</span><span class="op">(</span><span class="va">transformer</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/force.html" class="external-link">force</a></span><span class="op">(</span><span class="va">eval_env</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">unique_id</span> <span class="op">&lt;-</span> <span class="fu">new_id</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">env_bind_lazy</span><span class="op">(</span></span>
<span>    <span class="va">generators</span>,</span>
<span>    <span class="op">!</span><span class="op">!</span><span class="va">unique_id</span> <span class="op">:=</span> <span class="fu">inject</span><span class="op">(</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">transformer</span><span class="op">)</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">lambda_expr</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    eval.env <span class="op">=</span> <span class="va">eval_env</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">inject</span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">generators</span><span class="op">)</span><span class="op">[[</span><span class="op">!</span><span class="op">!</span><span class="va">unique_id</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="va">self</span>, <span class="va">private</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p>Returns:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co">#' #' Transform a deferred method</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description</span></span>
<span><span class="co">#' A short description...</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param lambda_expr A lambda expression to transform.</span></span>
<span><span class="co">#' @param transformer A transformer function or expression.</span></span>
<span><span class="co">#' @param eval_env The environment in which to evaluate the transformer.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns</span></span>
<span><span class="co">#' A function that, when called, will evaluate the transformed lambda expression.</span></span>
<span><span class="co">#' The returned function accepts `...` arguments which are passed to the generated function.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span></code></pre><p></p></div>
<p>A function that may raise a condition:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">set_default</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span>, <span class="va">default</span>, <span class="va">arg</span> <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is_testing</span><span class="op">(</span><span class="op">)</span> <span class="op">||</span> <span class="fu">is_snapshot</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_inform</a></span><span class="op">(</span><span class="st">"Using {.field {arg}} = {.val {default}}."</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">default</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">value</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p>Returns:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co">#' Set default value</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description</span></span>
<span><span class="co">#' A short description...</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param value A value to check.</span></span>
<span><span class="co">#' @param default The default value to use if `value` is NULL.</span></span>
<span><span class="co">#' @param arg Optional. The name of the argument being set.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns</span></span>
<span><span class="co">#' Returns `value` if it's not NULL, otherwise returns `default`.</span></span>
<span><span class="co">#' Informs the user when using the default value.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span></code></pre><p></p></div>
<p>A function with some tricky indexing:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">find_index</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">left</span>, <span class="va">e_right</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">e_right</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu">has_name</span><span class="op">(</span><span class="va">e_right</span>, <span class="st">"index"</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">e_right</span><span class="op">$</span><span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">matches_idx</span> <span class="op">&lt;-</span> <span class="fu">map_lgl</span><span class="op">(</span><span class="va">left</span>, <span class="kw">function</span><span class="op">(</span><span class="va">e_left</span><span class="op">)</span> <span class="va">e_left</span><span class="op">$</span><span class="va">index</span> <span class="op">==</span> <span class="va">e_right</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">matches_idx</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">matches_idx</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p>Returns:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#' Find matching index</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#' @description</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#' A short description...</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#' @param left A list of elements, each expected to have an 'index' field.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#' @param e_right A list with an 'index' field to search for in `left`.</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#' @returns</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#' The numeric index in `left` where `e_right$index` matches, or NA if not found</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#' or if inputs are invalid. Returns NA if multiple matches are found.</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#' @export</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="interfacing-manually-with-the-roxygen-pal">Interfacing manually with the roxygen pal<a class="anchor" aria-label="anchor" href="#interfacing-manually-with-the-roxygen-pal"></a></h2>



<p>Pals are typically interfaced with via the pal addin. To call the roxygen
pal directly, use:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pal_roxygen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dot-init_pal.html">.init_pal</a></span><span class="op">(</span><span class="st">"roxygen"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Then, to submit a query, run:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pal_roxygen</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="op">{</span><span class="va">x</span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

